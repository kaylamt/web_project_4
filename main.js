!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0);var n=class{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showErrorMessage(e){const t=this._form.querySelector(`#${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}_hideErrorMessage(e){const t=this._form.querySelector(`#${e.id}-error`);t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}_checkInputValidity(e,t,r){e.validity.valid?this._hideErrorMessage(e,t,r):this._showErrorMessage(e,t,r)}_toggleButtonState(){const e=this._inputs.every(e=>e.validity.valid),t=this._form.querySelector(this._submitButtonSelector);e?(t.classList.remove(this._inactiveButtonClass),t.disabled=!1):(t.classList.add(this._inactiveButtonClass),t.disabled=!0)}_setEventListeners(){const e=Array.from(this._form.querySelectorAll(this._inputSelector));this._form.querySelector(this._submitButtonSelector);e.forEach(e=>{e.addEventListener("input",()=>{this._checkInputValidity(),this._toggleButtonState()})})}enableValidation(){this._form.addEventListener("submit",e=>{e.preventDefault()}),this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._inputs.forEach(e=>{e.addEventListener("input",()=>{this._checkInputValidity(e,form),this._toggleButtonState()}),e.addEventListener("invalid",e=>{e.preventDefault()})})}};const s=document.querySelector(".popup_type_image"),i=s.querySelector(".popup__image"),o=s.querySelector(".popup__image-title");var a=class{constructor({currentUserId:e,data:t,deleteInputSelector:r,handleCardClick:n,handleDeleteClick:s,handleLikeClick:i,openDeleteConfirmation:o},a){this._link=t.link,this._name=t.name,this._likes=t.likes,this._templateSelector=a,this._handleCardClick=n,this._id=t._id,this._deleteInputElement=document.querySelector(r),this._handleDeleteClick=s,this._handleLikeClick=i,this._currentUserId=e,this._ownerId=t.owner._id,this._openDeleteConfirmation=o}_getCardTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".card")}updateLike(e){this._card.querySelector(".card__like-count").textContent=e,this._likeButton.classList.toggle("card__like-button_clicked")}_setEventListeners(){if(this._card.querySelector(".card__image").addEventListener("click",()=>{i.src=this._link,i.alt=this._name,o.textContent=this._name,this._handleCardClick(this._name,this._link)}),this._likeButton=this._card.querySelector(".card__like-button"),this._likeButton.addEventListener("click",e=>{const t=!e.target.classList.contains("card__like-button_clicked");this._handleLikeClick(this._id,t)}),this._currentUserId===this._ownerId){this._card.querySelector(".card__delete-button").addEventListener("click",()=>{this._deleteInputElement.value=this._id,this._openDeleteConfirmation()})}}handleDeleteClick(){this._handleDeleteClick(this._id)}deleteCard(){this._card.remove(),delete this._card}createNewCardElement(){this._card=this._getCardTemplate().cloneNode(!0);const e=this._card.querySelector(".card__image");if(this._card.querySelector(".card__title").textContent=this._name,this._card.querySelector(".card__like-count").textContent=this._likes.length,e.src=this._link,e.alt=this._name,this._currentUserId!==this._ownerId){this._card.querySelector(".card__delete-button").remove()}return this._likes.find(e=>e._id===this._currentUserId)&&this._card.querySelector(".card__like-button").classList.add("card__like-button_clicked"),this._setEventListeners(),this._card}};var l=class{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._handleClickClose=this._handleClickClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose),document.addEventListener("click",this._handleClickClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose),document.removeEventListener("click",this._handleClickClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleClickClose(e){(e.target.classList.contains("popup__close-button")||e.target===this._popupElement)&&this.close()}};var c=class extends l{constructor(e,t,r){super(r),this._imageTitleElement=this._popupElement.querySelector(e),this._imageElement=this._popupElement.querySelector(t)}open(e,t){this._imageTitleElement.textContent=e,this._imageElement.src=t,super.open()}};var d=class extends l{constructor(e,t){super(t),this._formElement=this._popupElement.querySelector("form"),this._submitCallback=e,this._runSubmitCallback=this._runSubmitCallback.bind(this),this._button=this._formElement.querySelector("button"),this._originalButtonTextContent=this._button.textContent}_getInputValues(){return Object.fromEntries(new FormData(this._formElement))}_runSubmitCallback(e){this._formElement.querySelector("button").textContent="Saving...",this._submitCallback(e,this._getInputValues())}open(){this._formElement.addEventListener("submit",this._runSubmitCallback),super.open()}close(){this._formElement.removeEventListener("submit",this._runSubmitCallback),this._formElement.reset(),this._button.textContent=this._originalButtonTextContent,super.close()}};var u=class{constructor({avatarSelector:e,nameSelector:t,descriptionSelector:r}){this._nameElement=document.querySelector(t),this._descriptionElement=document.querySelector(r),this._avatarElement=document.querySelector(e)}getUserInfo(){return{name:this._nameElement.textContent,description:this._descriptionElement.textContent}}setUserInfo(e,t){this._avatarElement.alt=e,this._nameElement.textContent=e,this._descriptionElement.textContent=t}setUserAvatar(e){this._avatarElement.src=e}};var _=class{constructor({items:e,renderer:t},r){this._items=e,this._renderer=t,this._container=document.querySelector(r)}renderer(){this._items.forEach(e=>{const t=this._renderer(e);this.addItem(t)})}addItem(e){this._container.prepend(e)}};var h=class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getCardList(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}getAppInfo(){return Promise.all([this.getUserInfo(),this.getCardList()])}addCard({name:e,link:t}){return fetch(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}removeCard(e){return fetch(this._baseUrl+"/cards/"+e,{headers:this._headers,method:"DELETE"}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}changeLikeCardStatus(e,t){const r=t?"PUT":"DELETE";return fetch(this._baseUrl+"/cards/likes/"+e,{method:r,headers:this._headers}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}setUserInfo({name:e,about:t}){return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}setUserAvatar(e){return fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject("error!"+e.statusText))}};const p=document.querySelector(".popup_type_edit-profile"),m=document.querySelector(".popup_type_add-card"),f=(document.queryCommandEnabled(".popup_type_edit-avatar"),p.querySelector(".form_edit")),C=m.querySelector(".form_add"),v=document.querySelector(".profile__edit-button_info"),b=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__avatar-edit-button"),y=document.querySelector(".popup__close-button_edit-profile"),S=document.querySelector(".form__input_field_name"),E=document.querySelector(".form__input_field_description"),g={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"popup__error_visible"},L=new d((function(e,{name:t,description:r}){e.preventDefault(),j.setUserInfo({name:t,about:r}).then(e=>{T.setUserInfo(e.name,e.about),L.close()}).catch(e=>console.log(e))}),".popup_type_edit-profile"),q=new c(".popup__image-title",".popup__image",".popup_type_image"),I=new n(g,f),U=new n(g,C),x=new d((function(e,{avatar:t}){e.preventDefault(),j.setUserAvatar(t).then(e=>{T.setUserAvatar(e.avatar),x.close()}).catch(e=>console.log(e))}),".popup_type_edit-avatar");I.enableValidation(),U.enableValidation();const j=new h({baseUrl:"https://around.nomoreparties.co/v1/group-4",headers:{authorization:"6a003bb7-5a61-4ed9-a0ac-4e04a1ae5c34","Content-Type":"application/json"}}),w=(new l(".popup_type_delete-card"),[]),T=new u({avatarSelector:".profile__avatar",nameSelector:".profile__info-name",descriptionSelector:".profile__info-description"});function D(){if(p.classList.contains("popup_opened"))L.close();else{L.open();const{name:e,description:t}=T.getUserInfo();S.value=e,E.value=t}}j.getAppInfo().then(e=>{const[t,r]=e;T.setUserAvatar(t.avatar),T.setUserInfo(t.name,t.about);const n=new _({items:r,renderer:c},".cards");n.renderer();const s=new d((function(e,{title:t,link:r}){e.preventDefault(),j.addCard({name:t,link:r}).then(e=>{const t=c(e);n.addItem(t),s.close()}).catch(e=>console.log(e))}),".popup_type_add-card");function i(e){return w.find(t=>t._id===e)}function o(e){j.removeCard(e).then(t=>{i(e).deleteCard()}).catch(e=>console.log(e))}function l(e,t){j.changeLikeCardStatus(e,t).then(t=>{i(e).updateLike(t.likes.length)}).catch(e=>console.log(e))}function c(e){const r=new a({currentUserId:t._id,data:e,deleteInputSelector:".form__input_field_card-id",handleCardClick:(e,t)=>{q.open(e,t)},handleDeleteClick:o,handleLikeClick:l,openDeleteConfirmation:()=>{u.open()}},".card-template");return w.push(r),r.createNewCardElement()}b.addEventListener("click",()=>{s.open()});const u=new d((function(e,{cardId:t}){e.preventDefault();i(t).handleDeleteClick(),u.close()}),".popup_type_delete-card")}).catch(e=>console.log(e)),v.addEventListener("click",D),y.addEventListener("click",D),k.addEventListener("click",()=>{x.open()})}]);